spring:
  datasource:
    url: jdbc:h2:mem:findme;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DB_CLOSE_DELAY=-1
    driverClassName: org.h2.Driver
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
  h2:
    console:
      enabled: true
  flyway:
    enabled: true
    locations: classpath:db/migration/h2
  security: # Added for OAuth2
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope:
              - openid
              - profile
              - email
          provider:
            google:
              issuer-uri: https://accounts.google.com

jwt: # Added for JWT
  secret: BmJKbUWK9LaVPT2mZCGkUDk7QsBQkUIGmGZBBOPUwXU= # Replace with a strong, base64 encoded secret
  expiration-minutes: 60 # Token expiration time in minutes

  bucket4j: # Added for Rate Limiting
    filters:
      - filter-url: "/**"
        rate-limit:
          bandwidths:
            - capacity: 60 # 60 requests per minute
              time: 1 # minute
              unit: minutes
        http-response-body-enabled: true
        http-response-body-json: true
        http-response-body-json-data: |
          {
            "code": "RATE_LIMITED",
            "message": "Too many requests. Please try again later.",
            "requestId": "${X-Request-Id}",
            "timestamp": "${T(java.time.LocalDateTime).now().format(T(java.time.format.DateTimeFormatter).ISO_INSTANT)}"
          }
        http-response-body-json-code: 429
        exclude-urls:
          - /api/health
          - /swagger-ui/**
          - /v3/api-docs/**

admin: # Added for Admin API
  token: ${ADMIN_TOKEN:dev-admin-token} # Externalized to environment variable

logging:
  level:
    root: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security.oauth2: DEBUG
    org.springframework.web.client: DEBUG